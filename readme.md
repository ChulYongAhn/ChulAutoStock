# ChulAutoStock - 자동 주식 트레이딩 시스템

## 📌 프로젝트 개요
**목표**: 한국투자증권 API를 활용한 24시간 자동 매매 시스템
**특징**: 24시간 상시 구동, 매일 08:29 자동 시작, 10:00 자동 종료
**개발자**: Unity + C# 전문, Python & 서버 학습 중

## 🛠️ 개발 환경
- **언어**: Python 3.11
- **OS**: macOS (개발) → Linux 서버 (운영)
- **IDE**: VSCode + Claude Code
- **버전 관리**: GitHub + GitHub Desktop
- **API**: 한국투자증권 OpenAPI

## 🎯 마일스톤
1. ✅ **1단계**: 로컬 PC에서 안정적으로 동작하는 프로그램 완성
2. 🔄 **2단계**: 24시간 상시 구동 서버 배포
3. 🎯 **3단계**: 완전 자동 매수/매도 시스템

---

## 🔄 24시간 구동 시스템

### 🌙 대기 모드 (10:00 ~ 다음날 08:29)
**프로그램은 24시간 켜있지만 거래 시간 외에는 대기 상태**
- 1분마다 시간 체크
- 주말/공휴일 자동 감지 및 스킵
- 메모리/CPU 최소 사용
- 다음 거래일 08:29 자동 감지

---

## 📊 거래 Phase (매일 08:29 ~ 10:00 자동 실행)

### ⏰ Phase 0: 일일 초기화 (08:29)
**대기 모드에서 깨어나 당일 거래 준비**
- 거래일 여부 확인
- 한국투자증권 API 토큰 발급/갱신
- 계좌 잔고 확인
- 전일 캐시 데이터 초기화
- 당일 거래 환경 체크

### 📈 Phase 1: 데이터 준비 (08:30 ~ 08:35)
**거래 전 필수 데이터 수집**
- 코스피 100개 종목 전일 OHLCV 조회
- 20일/5일 이동평균선 계산
- 전일 거래량 평균 계산
- 관리종목/투자주의 종목 필터링
- 데이터 캐싱 완료

### 🔍 Phase 2: 동시호가 모니터링 (08:35 ~ 08:58)
**실시간으로 동시호가 상황을 분석하여 최적 매수 종목 선정**
- 매 10초마다 100개 종목 순회
- 예상 체결가/거래량 분석
- 동적 필터링 및 스코어링
- 순위 실시간 업데이트

**1차 필터 — 정적 조건** (첫 사이클 1회 판정)

- 전일 등락률 > 0%, < +10%
- 관리종목 / 투자주의 / 정리매매 제외
- 전일 거래량 ≥ 20일 평균의 1.5배

**2차 필터 — 기술적 조건** (첫 사이클 1회 판정)

- 전일 종가 > 5일 이동평균선
- 전일 양봉 (시가 < 종가)
- 전일 윗꼬리 비율 < 30%

**3차 필터 — 동시호가 조건** (매 사이클 반복)

- 예상 시초가: 전일 종가 대비 +1% ~ +4% 갭업
- 예상 체결 거래량 ≥ 전일 거래량의 5%
- 매수잔량 / 매도잔량 ≥ 1.2
- 매도 1~5호가 매물 총량 < 예상 거래량의 20%

**4차 필터 — 시장 환경** (매 사이클 반복)

- 코스피200 선물 전일 대비 +0.2% 이상
- USD/KRW 환율 급등 없음

**스코어링** (매 사이클 갱신)

| 항목 | 배점 | 기준 |
|------|------|------|
| 갭 크기 적정성 | 25 | +2~3% 최고점, 양 끝 감점 |
| 수급 강도 | 25 | 예상거래량 / 전일거래량 |
| 매수-매도 잔량비 | 20 | 비율 높을수록 가점 |
| 전일 거래량 증가율 | 15 | 20일 평균 대비 배율 |
| 5일선 이격도 | 15 | 5일선 바로 위일수록 가점 |

### 🎯 Phase 3: 최종 선정 및 매수 준비 (08:58 ~ 09:00)
**동시호가 마감 직전 최종 매수 종목 확정**
- **08:58:00**: Phase 2 모니터링 중지
- **08:58:10**: 최종 스코어링 기준 상위 3종목 선정
- **08:58:30**: 자금 배분 계산 (종목당 33%)
- **08:59:00**: 시장가 매수 주문 접수
- **08:59:50**: 주문 상태 최종 확인
- **09:00:00**: 장 시작 - 자동 체결

### 📊 Phase 4: 포지션 관리 (09:00 ~ 09:59)
**보유 종목 실시간 모니터링 및 자동 매매**
- 매 5초마다 보유 종목 현재가 체크
- **익절 조건**:
  - +4% 도달 시 전량 매도
  - +3% 도달 후 하락 시 50% 매도
- **손절 조건**:
  - -2% 하락 시 전량 매도
  - -1.5% 경고 알림
- **추가 매수**:
  - 급락 후 반등 시 추가 매수 검토
- 실시간 수익률 대시보드 갱신

### 🏁 Phase 5: 일일 청산 및 리포트 (09:59 ~ 10:00)
**당일 거래 마감 및 다음 거래일 준비**
- **09:59:00**: 신규 매수 중단
- **09:59:30**: 모든 미체결 주문 취소
- **09:59:40**: 보유 종목 전량 시장가 매도
- **09:59:50**: 체결 확인
- **10:00:00**:
  - 일일 거래 리포트 생성
  - 수익률 통계 저장
  - API 사용량 기록
  - 로그 파일 정리
  - **대기 모드 전환** → 다음 거래일 08:29까지


---

## ⏱️ 24시간 타임라인

```
00:00 ~ 08:28  😴 대기 모드 (Deep Sleep)
                  - 40초마다 시간 체크
                  - CPU/메모리 최소 사용

08:29  🔔 Wake Up! 거래 준비 시작
       Phase 0: 일일 초기화
         - API 토큰 발급
         - 계좌 상태 확인

08:30  Phase 1: 데이터 준비 (5분)
         - 전일 데이터 수집
         - 이동평균선 계산

08:35  Phase 2: 동시호가 모니터링 (23분)
  │      - 10초 간격 실시간 분석
  │      - 100개 종목 순회
  │      - 동적 스코어링
  ▼
08:58  Phase 3: 최종 선정 (2분)
         - 상위 3종목 확정
         - 매수 주문 접수

09:00  🔔 장 시작! 자동 체결
  │    Phase 4: 포지션 관리 (59분)
  │      - 실시간 시세 감시
  │      - 익절/손절 자동 실행
  ▼
09:59  Phase 5: 일일 마감 (1분)
         - 전량 청산
         - 리포트 생성

10:00  😴 대기 모드 진입
  │
  ▼
[다음 거래일 08:29까지 대기]
━━━━━━━━━━━━━━━━━━━━━━━━━━
       총 22시간 29분 대기
━━━━━━━━━━━━━━━━━━━━━━━━━━
```

## 🔄 프로그램 라이프사이클

1. **프로그램 최초 실행**: 한 번만 실행하면 계속 구동
2. **매일 08:29**: 자동으로 당일 작업 시작
3. **매일 10:00**: 당일 작업 종료 후 대기 모드
4. **주말/공휴일**: 자동 스킵, 다음 거래일 대기
5. **에러 발생 시**: 자동 복구 및 재시작

